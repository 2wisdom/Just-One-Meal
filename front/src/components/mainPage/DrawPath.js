import { useRef } from "react";
import useScrollEffect from "../../hooks/useScrollEffect";
import styled from "@emotion/styled";

const Wrapper = styled("div")`
  .drawpath-root {
    position: absolute;
    z-index: -1;
    top: 80vh;
    left: 0;
  }

  .drawpath-path {
    stroke-width: 4px;
  }
`;

export default function DrawPath() {
  const parentRef = useRef();
  const pathRef = useRef();

  const calcDashoffset = (scrollY, element, length) => {
    const ratio = (scrollY - element.offsetTop) / element.offsetHeight;
    const value = length - length * ratio;
    return value < 0 ? 0 : value > length ? length : value;
  };

  const scrollHandler = () => {
    const path = pathRef.current;
    const content = parentRef.current;
    const pathLength = path.getTotalLength();
    path.style.strokeDasharray = pathLength;
    path.style.strokeDashoffset = pathLength;

    const scrollY = window.scrollY + window.innerHeight * 0.8;
    path.style.strokeDashoffset = calcDashoffset(scrollY, content, pathLength);
  };

  useScrollEffect(() => {
    scrollHandler();
  });

  return (
    <Wrapper>
      <div className="drawpath-root" ref={parentRef}>
        <svg width="1880" height="2576" viewBox="0 0 1893 2583" fill="none">
          <path
            ref={pathRef}
            className="drawpath-path"
            d="M455.924 309.052C480.254 303.886 541.71 278.259 592.902 217.074C600.9 208.276 609.566 219.74 612.898 226.572C627.229 251.899 668.089 301.953 716.881 299.554C777.871 296.555 803.367 253.565 812.365 191.58C821.364 129.595 824.363 130.595 844.86 99.1029C865.357 67.6105 873.355 29.1199 857.858 13.6237C842.36 -1.87253 819.864 -3.37216 817.365 10.6244C814.865 24.621 791.869 61.1121 785.37 69.6101C778.871 78.108 733.878 157.589 671.889 165.587C656.891 165.587 655.891 159.088 677.388 134.094C698.884 109.1 721.88 77.6081 725.88 71.6096C729.879 65.611 741.377 51.6144 763.373 49.6149C780.97 48.0153 863.024 38.9509 901.85 34.6186C911.516 33.9521 941.344 35.5184 983.337 47.1155C1035.83 61.612 1091.82 73.6091 1095.32 75.6086C1098.82 77.6081 1111.82 82.107 1101.82 99.1029C1091.82 116.099 1062.82 119.098 1056.82 119.098C1050.83 119.098 987.336 112.6 983.337 110.6C979.338 108.601 927.846 108.101 914.848 116.599C901.85 125.097 865.856 131.595 835.861 184.582C805.866 237.569 822.864 301.054 832.862 317.55C842.86 334.046 859.358 366.038 905.35 386.533C951.342 407.028 1017.83 392.032 1034.33 377.535C1050.83 363.039 1096.32 337.545 1105.32 264.563C1114.32 191.58 1044.83 128.596 1034.33 127.096C1023.83 125.596 1014.83 127.596 1008.83 129.595C1002.83 131.595 979.838 143.592 972.339 150.59C964.84 157.589 938.344 147.091 934.845 145.592C931.346 144.092 918.348 132.095 911.849 150.59C906.65 165.387 891.352 172.418 884.353 174.085C883.52 180.583 884.453 192.38 894.852 187.581C907.849 181.583 920.347 177.584 929.346 184.582C938.344 191.58 947.343 196.079 938.344 207.576C934.845 214.575 908.849 202.078 905.35 202.578C901.85 203.078 888.353 196.579 871.356 214.075C865.357 223.073 867.856 230.071 864.357 237.569C860.857 245.067 856.858 262.063 866.356 264.563C875.855 267.062 888.353 269.561 896.851 281.059C905.35 292.556 904.85 313.051 908.349 336.045C911.849 359.04 931.845 355.041 938.344 345.543C944.843 336.045 956.341 319.549 955.842 315.05C955.342 310.551 957.841 299.054 961.341 290.056C964.84 281.059 976.838 272.561 975.838 268.562C974.838 264.563 972.339 242.068 983.337 241.568C994.335 241.068 1005.33 227.572 1015.83 248.067C1019.83 254.565 1017.83 261.563 1042.33 259.064C1066.82 256.565 1075.32 237.569 1076.82 229.071C1078.32 220.573 1077.82 202.578 1067.32 202.578C1056.82 202.578 1058.32 226.072 1070.32 259.064C1082.32 292.056 1079.82 285.058 1067.32 300.054C1058.82 311.051 1059.32 317.55 1059.82 322.049C1060.32 326.547 1055.33 329.547 1048.83 331.546C1042.33 333.546 1042.33 335.045 1042.33 355.041C1042.33 375.036 1045.33 385.533 1027.83 399.53C1008.33 411.027 962.34 417.525 933.845 410.527C905.35 403.529 827.363 370.537 821.364 370.037C815.365 369.537 765.373 363.538 767.373 389.032C774.172 406.228 821.197 430.189 843.86 440.02C870.689 456.349 926.246 489.308 933.845 490.508C943.344 492.007 954.342 500.505 986.336 500.505C1018.33 500.505 1082.32 519.5 1088.82 519.5C1095.32 519.5 1114.32 526.499 1144.31 500.505C1174.31 474.511 1226.8 449.518 1216.8 440.02C1206.8 430.522 1190.8 428.023 1158.31 438.02C1125.81 448.018 1065.82 500.005 1057.32 504.004C1048.83 508.003 1022.83 546.494 1017.33 546.494C1011.83 546.494 986.336 547.994 986.336 514.002C986.336 480.01 1003.33 467.513 1042.33 432.022C1081.32 396.53 1073.82 371.037 1081.32 363.039C1088.82 355.041 1113.32 267.062 1208.8 294.555C1261.29 304.553 1274.15 356.308 1283.79 367.411C1306.78 393.904 1335.78 374.409 1346.28 371.41C1356.78 368.411 1400.27 349.042 1467.76 354.041C1565.24 361.261 1574.24 374.909 1589.74 407.028C1615.43 460.27 1511.28 585.267 1496.75 594.482C1477.26 606.852 1381.27 641.471 1310.28 657.467C1239.29 673.463 1095.32 710.454 1081.32 790.435C1069.32 855.919 1131.31 845.421 1178.3 867.916C1225.3 890.41 1220.8 872.914 1357.77 968.891C1409.77 1008.88 1533.25 1016.38 1554.24 1014.88C1575.24 1013.38 1616.73 1020.88 1629.73 1054.37C1642.73 1087.86 1598.02 1075.83 1582.24 1086.36C1523.25 1125.73 1520.25 1141.5 1468.26 1132.35C1434 1121 1401.77 1111.7 1379.77 1132.35C1357.77 1153 1368.22 1177 1345 1189.5C1321.78 1202 1307.5 1232 1301.78 1238.83C1293.97 1248.16 1234.3 1315.31 1261.29 1353.3C1288.29 1391.29 1340.28 1413.78 1340.28 1413.78C1338.11 1422.95 1321.78 1455.77 1321.78 1455.77C1318.78 1455.77 1313.68 1452.77 1317.28 1440.78C1321.78 1425.78 1309.28 1419.78 1301.78 1419.28C1294.29 1418.78 1282.79 1410.78 1282.79 1404.28C1282.79 1397.79 1266.79 1394.79 1261.29 1404.28C1255.79 1413.78 1251.29 1413.78 1247.79 1413.78C1244.99 1413.78 1253.96 1398.12 1258.79 1390.29C1260.12 1386.96 1245.29 1377.29 1245.29 1377.29C1243.96 1376.13 1242.59 1371.39 1247.79 1361.8C1254.29 1349.8 1232.48 1350.12 1229.3 1353.3C1225.8 1356.8 1214.3 1377.29 1225.8 1381.79C1228.8 1382.46 1235.3 1383.39 1237.29 1381.79C1238.79 1380.96 1240.89 1381.49 1237.29 1390.29C1232.8 1401.29 1224.8 1403.78 1241.79 1416.28C1258.79 1428.78 1238.79 1435.28 1253.79 1444.28C1268.79 1453.27 1279.29 1430.28 1282.79 1426.28C1286.29 1422.28 1290.29 1420.28 1288.29 1430.78C1286.29 1441.28 1263.29 1464.27 1289.79 1472.77C1299.38 1479.17 1308.78 1469.44 1312.28 1463.77C1315.12 1463.6 1320.68 1464.97 1320.28 1471.77C1319.78 1480.27 1326.28 1494.26 1334.78 1496.76C1343.28 1499.26 1361.27 1496.76 1368.77 1471.77C1376.27 1446.77 1373.27 1432.78 1362.77 1423.28C1352.28 1413.78 1374.27 1404.28 1378.77 1404.28C1383.27 1404.28 1393.27 1373.29 1388.27 1355.8C1383.27 1338.3 1370.77 1288.81 1385.77 1264.82C1400.77 1240.82 1417.82 1247.76 1447.26 1222.83C1463 1209.5 1474.76 1169.34 1508.75 1162.84C1542.74 1156.35 1554.24 1152.35 1573.74 1183.34C1589.34 1208.13 1563.57 1239.99 1548.74 1252.82C1527.41 1261.15 1483.65 1284.81 1479.25 1312.81C1479.25 1331.3 1485.64 1328.9 1477.26 1338.5C1468.26 1348.8 1461.26 1341.8 1454.26 1348.8C1447.26 1355.8 1424.76 1374.29 1429.76 1401.29C1434.76 1428.28 1457.26 1416.28 1468.26 1408.78C1479.25 1401.29 1478.75 1415.28 1477.26 1419.28C1475.76 1423.28 1480.75 1442.28 1497.75 1434.28C1514.75 1426.28 1516.75 1401.29 1520.25 1401.29C1523.75 1401.29 1526.25 1399.29 1523.25 1411.28C1520.25 1423.28 1518.75 1442.78 1539.24 1436.78C1559.74 1430.78 1545.24 1423.78 1570.24 1430.28C1581.04 1430.28 1584.4 1415.95 1584.74 1408.78C1585.07 1406.95 1586.84 1404.88 1591.24 1411.28C1596.74 1419.28 1603.73 1418.28 1608.73 1411.28C1613.73 1404.28 1620.23 1387.79 1605.73 1386.29C1598.24 1386.29 1598.34 1382.79 1591.24 1398.29C1586.57 1395.95 1577.98 1393.86 1573.74 1396.29C1570.24 1398.29 1565.24 1398.29 1560.24 1416.28C1557.74 1418.61 1553.04 1420.38 1554.24 1408.78C1555.44 1397.19 1550.41 1394.29 1547.74 1394.29C1542.14 1391.09 1535.08 1394.29 1532.25 1396.29C1527.91 1395.12 1518.55 1391.89 1515.75 1388.29C1512.25 1383.79 1496.27 1379.73 1488.75 1391.29C1482.25 1401.29 1484.25 1398.29 1479.25 1398.29C1478.59 1395.79 1478.95 1388.09 1485.75 1377.29C1485.75 1360.3 1493.75 1356.8 1495.75 1356.8C1511.92 1364.29 1546.84 1378.89 1557.24 1377.29C1570.24 1375.29 1605.73 1378.29 1630.73 1344.8C1650.73 1318.01 1650.39 1247.99 1647.73 1216.33C1647.06 1208.33 1648.13 1188.44 1657.73 1172.84C1669.72 1153.35 1677.72 1115.36 1660.72 1095.86C1643.73 1076.36 1663.72 1059.87 1676.72 1060.87C1689.72 1061.87 1722.71 1066.37 1779.7 1106.86C1825.3 1139.25 1844.36 1179.84 1846.69 1195.84C1846.69 1195.84 1898.19 1348.8 1886.19 1419.28C1881.23 1448.39 1849.69 1600.24 1800.2 1696.21C1750.71 1792.19 1701.72 1859.17 1688.22 1942.65C1674.72 2026.13 1657.73 2129.48 1719.21 2191.09C1733.12 2205.03 1756.71 2238.58 1771.71 2271.07C1782.62 2294.72 1788.04 2393.08 1771.71 2433.41C1761.43 2458.77 1762.61 2496.32 1672.22 2511.52C1579.44 2518.31 1534.25 2517.35 1523.25 2516.01C1470.26 2515.68 1358.17 2514.31 1333.78 2511.52C1331.78 2511.52 1330.95 2508.52 1330.78 2507.02C1326.11 2494.52 1310.98 2469.73 1287.79 2470.53C1258.79 2471.53 1235.8 2494.52 1236.3 2524.01C1236.79 2553.51 1263.79 2569 1283.29 2567C1302.78 2565 1322.28 2552.51 1330.78 2536.01C1339.28 2519.51 1316.28 2475.52 1310.28 2470.53C1304.28 2465.53 1269.79 2432.53 1308.78 2386.55C1347.78 2340.56 1394.77 2347.06 1433.76 2271.07C1464.96 2210.29 1436.1 2145.1 1417.76 2120.11C1400.27 2100.78 1352.28 2062.42 1300.28 2063.62C1235.3 2065.12 1177.3 2103.11 1149.81 2158.6C1122.31 2214.09 1159.31 2223.09 1169.81 2227.08C1180.3 2231.08 1213.3 2209.59 1232.8 2181.1C1252.29 2152.6 1313.78 2141.11 1337.78 2179.1C1361.77 2217.09 1330.78 2267.57 1319.78 2274.07C1308.78 2280.57 1253.79 2322.06 1249.29 2328.56C1244.79 2335.06 1212.3 2359.55 1237.79 2421.54C1243.96 2427.37 1261.69 2439.93 1283.29 2443.53C1310.28 2448.03 1333.78 2465.53 1339.78 2488.52C1345.78 2511.52 1338.78 2529.51 1318.28 2558.5C1313.78 2561.84 1303.08 2568.8 1296.29 2570C1289.49 2571.2 1234.8 2573.17 1208.3 2574H976.338H0"
            stroke="black"
          />
        </svg>
      </div>
    </Wrapper>
  );
}
